# Подготовка перед работой
Для приложения в качестве примера используется локальная база даннх LocalDb (MS SQL Server).

В проекте есть три скрипта:
1. CreateDatabase.sql - создает базу данных DealDB
2. CreateTables.sql - создает таблицы компаний, сделок и аббревиатур названий компаний с заполнением начальных данных.
3. CreateUpdateProcedures.sql - создает необходимые типы и процедуры для обновления данных в бд

Перед запуском надо: подключиться к бд; запустить скрипты последовательно; в App.config в connectionString ввести строку подключения к бд (если используется не localDb).

# Работа приложения
Приложение совершает обход источника с паузой в 10 минут между обходами.

Источник обходится постранично по 5000 сделок на страницу. Пауза между запросом страниц дополнительно увеличивается на секунду, так как при запросе по 5000 средняя обработка проходит за 3,5-4 секунды и если пауза меньше 5 секунд между запросами, то вероятность того, что база данных источника повиснет повышается.

Принцип обработки:
1. Получаем сделки
2. Собираем сделки в словарь с ключом из номера сделки, а компании собираем словарь словарей (по инн, потом по именам).
3. Если сделка уже в словаре, то проверяем обновления данных: объем закупки покупателя/заказчика поменялся и не равен 0.
4. Обработка компаний: если инн компании нет в словаре, то добавляем новый словарь по этому инн с компанией; если инн компании есть, то идет поиск по имени, если нет, то добавляется новая.
5. После того как источник обойден, то идет синхронизация компаний, затем идет синхронизация сделок (так как в сделках прописаны айдишники компаний).
6. Синхронизация компаний идет по схожему принципу, только поиск компании с таким же инн и названием идет без учета угловых скобок и лишних пробелов (эта же обработка идет при корректировки имени компании, если есть аббревиатуры и другие символы в строке с именем).
7. Синхронизация сделок идет так: получаем из бд айдишники покупателя и заказчика, проверяем сделку в бд: если в бд есть, то обновляем данные по объемам закупки, если нет, то добавляем сделку на вставку.

Особенности: 
1. Если происходит ошибка, то в консоль выводится лог с красным текстом ошибки, стека вызовов.
2. Если произошла ошибка при попытке получить данные из источника при отправке http запроса, то попыток делается до 5 с паузой между попытками в минуту.
3. Есть логи статистики затраченного времени зеленого цвета, а желтого цвета для неудачных попыток получения данны из источника.
4. Работа с бд через DbRepository, а в DataConverter идет конветрирование данных в DTO и формирование строк для скриптов к бд